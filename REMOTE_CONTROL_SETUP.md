# 🌐 Система удаленного управления - Инструкция по развертыванию

## ⚠️ ВАЖНОЕ ПРЕДУПРЕЖДЕНИЕ

Эта система создана **ТОЛЬКО ДЛЯ ОБРАЗОВАТЕЛЬНЫХ ЦЕЛЕЙ** в рамках курсовой работы. 

**НЕ ИСПОЛЬЗУЙТЕ** для:
- ❌ Мошенничества
- ❌ Обмана людей
- ❌ Коммерческих целей

---

## 📋 Что создано

### 1. **Backend Server** (Node.js)
- ✅ REST API для управления клиентами и правилами
- ✅ База данных SQLite
- ✅ Автоматическая регистрация клиентов

### 2. **Admin Panel** (Web)
- ✅ Красивый веб-интерфейс
- ✅ Управление клиентами
- ✅ Создание правил замены номеров
- ✅ Статистика в реальном времени

### 3. **Android App** (модифицированное)
- ✅ Интеграция с API
- ✅ Автоматическая загрузка правил с сервера
- ✅ Fallback на локальные настройки при ошибке

---

## 🚀 Быстрый старт

### Шаг 1: Установка Node.js

**Windows:**
1. Скачайте: https://nodejs.org/
2. Установите LTS версию
3. Проверьте: `node --version`

**Linux:**
```bash
sudo apt update
sudo apt install nodejs npm
```

### Шаг 2: Запуск сервера

```bash
# Перейдите в папку сервера
cd server

# Установите зависимости
npm install

# Запустите сервер
npm start
```

Сервер запустится на **http://localhost:3000**

### Шаг 3: Откройте админ-панель

Откройте браузер: **http://localhost:3000**

### Шаг 4: Настройка Android приложения

1. Соберите APK (см. предыдущие инструкции)
2. Установите на устройство
3. В приложении:
   - Включите "Удаленный режим"
   - Введите URL сервера (например: `http://192.168.1.100:3000`)
   - Нажмите "Регистрация на сервере"

### Шаг 5: Создание правил

1. Откройте админ-панель в браузере
2. Найдите зарегистрированное устройство
3. Нажмите на устройство
4. Добавьте правило:
   - **Оригинальный номер**: номер с которого звонят (например: `+79991234567`)
   - **Отображаемый номер**: что покажется клиенту (например: `+79999999999`)
   - **Описание**: опционально (например: "Офис")
5. Нажмите "Добавить правило"

---

## 📡 Архитектура системы

```
┌─────────────────┐
│  Android App    │  ← Клиент 1
│  (Device 1)     │
└────────┬────────┘
         │
         │  HTTP REST API
         │
         ▼
┌─────────────────────────────────┐
│      Node.js Server             │
│  ┌──────────────────────────┐  │
│  │   REST API Endpoints     │  │
│  └──────────────────────────┘  │
│  ┌──────────────────────────┐  │
│  │   SQLite Database        │  │
│  │   - clients              │  │
│  │   - rules                │  │
│  └──────────────────────────┘  │
└─────────┬───────────────────────┘
          │
          │  HTTP
          │
          ▼
┌─────────────────┐
│   Admin Panel   │  ← Администратор
│   (Web Browser) │
└─────────────────┘
```

---

## 🔧 API Endpoints

### Для Android App

| Метод | Endpoint | Описание |
|-------|----------|----------|
| POST | `/api/client/register` | Регистрация устройства |
| GET | `/api/client/:id/rules` | Получить все правила |
| GET | `/api/client/:id/rule/:number` | Проверить правило для номера |

### Для Admin Panel

| Метод | Endpoint | Описание |
|-------|----------|----------|
| GET | `/api/admin/clients` | Список всех клиентов |
| GET | `/api/admin/clients/:id` | Данные клиента |
| POST | `/api/admin/rules` | Создать правило |
| PUT | `/api/admin/rules/:id` | Обновить правило |
| DELETE | `/api/admin/rules/:id` | Удалить правило |
| DELETE | `/api/admin/clients/:id` | Удалить клиента |
| GET | `/api/admin/stats` | Статистика |

---

## 💡 Примеры использования

### Пример 1: Офисный номер

**Сценарий**: Когда звонят с корпоративного номера `+74951234567`, показывать клиенту красивый номер `+79999999999`

**Настройка**:
1. Оригинальный: `+74951234567`
2. Отображаемый: `+79999999999`
3. Описание: "Офис компании"

### Пример 2: Директор

**Сценарий**: Звонки от директора с номера `+79161234567` показывать как `+79000000001`

**Настройка**:
1. Оригинальный: `+79161234567`
2. Отображаемый: `+79000000001`
3. Описание: "Директор"

---

## 🔐 Безопасность

**Для курсовой работы** базовая реализация без аутентификации достаточна.

**Для продакшена** (НЕ ДЕЛАЙТЕ ЭТО!) потребуется:
- 🔒 API ключи
- 🔒 HTTPS шифрование
- 🔒 Аутентификация администратора
- 🔒 Rate limiting
- 🔒 Логирование всех действий

---

## 📱 Настройка в Android приложении

### В MainActivity нужно добавить (код уже подготовлен):

1. **CheckBox "Удаленный режим"** - включает/выключает загрузку правил с сервера
2. **EditText "URL сервера"** - адрес вашего сервера
3. **Button "Регистрация"** - регистрирует устройство на сервере
4. **Button "Синхронизация"** - загружает правила с сервера

### Логика работы:

```
Входящий звонок → Проверка режима
                     │
        ┌────────────┴────────────┐
        │                         │
   Удаленный режим          Локальный режим
        │                         │
   Запрос к серверу         Локальные настройки
        │                         │
   Правило найдено?              │
        │                         │
   ┌────┴────┐                   │
   ДА        НЕТ                 │
   │          │                   │
   │    Локальные настройки      │
   │          │                   │
   └────┬─────┴───────────────────┘
        │
   Показать overlay
```

---

## 🌐 Развертывание на сервере (для реального использования)

### Вариант 1: На своем компьютере (для тестов)

Используйте локальную сеть:
- Сервер: `http://192.168.1.X:3000`
- Устройства должны быть в той же сети

### Вариант 2: VPS/Cloud (Heroku, DigitalOcean, AWS)

```bash
# На сервере
git clone <ваш-репозиторий>
cd server
npm install
npm start
```

Настройте firewall:
```bash
sudo ufw allow 3000
```

### Вариант 3: Ngrok (для быстрого тестирования)

```bash
# Запустите сервер
npm start

# В другом терминале
ngrok http 3000

# Используйте URL из ngrok в Android приложении
# Например: https://abc123.ngrok.io
```

---

## 📊 База данных

SQLite база данных содержит 2 таблицы:

### clients
| Поле | Тип | Описание |
|------|-----|----------|
| id | TEXT | Уникальный ID клиента (UUID) |
| device_id | TEXT | Android ID устройства |
| device_name | TEXT | Название устройства |
| registered_at | DATETIME | Дата регистрации |
| last_seen | DATETIME | Последняя активность |

### rules
| Поле | Тип | Описание |
|------|-----|----------|
| id | INTEGER | Уникальный ID правила |
| client_id | TEXT | ID клиента |
| original_number | TEXT | Оригинальный номер |
| display_number | TEXT | Отображаемый номер |
| description | TEXT | Описание |
| enabled | INTEGER | Активно ли правило (1/0) |
| created_at | DATETIME | Дата создания |

---

## 🐛 Troubleshooting

### Проблема: "Connection error"

**Решение**:
1. Проверьте, запущен ли сервер
2. Проверьте URL в приложении
3. Убедитесь, что устройство в той же сети
4. Проверьте firewall

### Проблема: "Client not registered"

**Решение**:
1. Нажмите "Регистрация на сервере" в приложении
2. Проверьте логи сервера
3. Проверьте подключение к интернету

### Проблема: Правила не применяются

**Решение**:
1. Убедитесь, что "Удаленный режим" включен
2. Проверьте правильность номера в правиле
3. Проверьте логи приложения (adb logcat)

---

## 📝 Для защиты курсовой

### Что рассказать:

1. **Архитектура**:
   - Client-Server модель
   - REST API
   - База данных SQLite

2. **Технологии**:
   - Backend: Node.js + Express
   - Frontend: HTML/CSS/JavaScript
   - Mobile: Android + Java + OkHttp
   - Database: SQLite

3. **Особенности**:
   - Автоматическая регистрация клиентов
   - Удаленное управление настройками
   - Fallback на локальные настройки
   - Real-time синхронизация

4. **Безопасность**:
   - Обсудите, что это учебный проект
   - Расскажите какие меры безопасности нужны для продакшена

### Демонстрация:

1. Покажите админ-панель
2. Зарегистрируйте тестовое устройство
3. Создайте правило
4. Покажите как работает на устройстве

---

## ✅ Чек-лист перед защитой

- [ ] Сервер запускается без ошибок
- [ ] Админ-панель открывается в браузере
- [ ] Android приложение собрано и установлено
- [ ] Устройство зарегистрировано на сервере
- [ ] Создано тестовое правило
- [ ] Правило работает при входящем звонке
- [ ] Подготовлена презентация
- [ ] Понимание архитектуры системы

---

## 📚 Дополнительные материалы

- **Node.js**: https://nodejs.org/docs
- **Express.js**: https://expressjs.com/
- **Android Networking**: https://developer.android.com/training/basics/network-ops
- **REST API**: https://restfulapi.net/

---

## 🎓 Заключение

Вы создали полноценную систему удаленного управления с:
- ✅ Backend сервером
- ✅ Веб админ-панелью
- ✅ Интеграцией в Android приложение
- ✅ База данных для хранения правил

Это демонстрирует знание:
- Client-Server архитектуры
- RESTful API
- Баз данных
- Веб-разработки
- Android разработки
- Сетевого программирования

**Удачи на защите курсовой! 🎓🚀**

